<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>@martinomburajr</title>
        
        <meta name="robots" content="noindex" />
        

        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Martin Ombura Jr. Website">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="about/bio.html"><strong aria-hidden="true">1.</strong> About Me</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="about/bio.html"><strong aria-hidden="true">1.1.</strong> Bio</a></li></ol></li><li class="chapter-item expanded "><a href="blog/blog.html"><strong aria-hidden="true">2.</strong> Blog</a></li><li><ol class="section"><li class="chapter-item expanded "><strong aria-hidden="true">2.1.</strong> Go</li><li><ol class="section"><li class="chapter-item expanded "><a href="blog/go/net-pkg/1-sockets-the-genesis-of-golang-connections-1/article.html"><strong aria-hidden="true">2.1.1.</strong> Sockets: The Genesis of Golang Connections</a></li><li class="chapter-item expanded "><a href="blog/go/net-pkg/2-how-golang-connections-are-made-at-a-kernel-level/article.html"><strong aria-hidden="true">2.1.2.</strong> How Golang Connections are Made at a Kernel Level</a></li></ol></li><li class="chapter-item expanded "><strong aria-hidden="true">2.2.</strong> DataStructures &amp; Algorithms</li><li><ol class="section"><li class="chapter-item expanded "><strong aria-hidden="true">2.2.1.</strong> Computational Complexity</li><li><ol class="section"><li class="chapter-item expanded "><strong aria-hidden="true">2.2.1.1.</strong> Pseudo-polynomial Time</li></ol></li><li class="chapter-item expanded "><a href="datastructures-and-algorithms/algorithms/algorithms.html"><strong aria-hidden="true">2.2.2.</strong> Algorithms</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="datastructures-and-algorithms/algorithms/dynamic/dynamic.html"><strong aria-hidden="true">2.2.2.1.</strong> Dynamic Programming</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="datastructures-and-algorithms/algorithms/dynamic/coinchange/coinchange.html"><strong aria-hidden="true">2.2.2.1.1.</strong> Coin-Change Problem</a></li></ol></li></ol></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">@martinomburajr</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <p><img src="about/me.jpg" alt="Martin Ombura Jr." /></p>
<h1><a class="header" href="#bio" id="bio">Bio</a></h1>
<p>Hello there! My name is <strong>Martin Ombura Jr.</strong> A software engineer based in Cape Town, South Africa currently working on 
<strong>Distributed Systems</strong> and <strong>Evolutionary Computation</strong> in <strong>Go</strong> and <strong>Rust</strong>. </p>
<p><strong>Email:</strong> me@martinomburajr.com</p>
<p><img src="about/me.jpg" alt="Martin Ombura Jr." /></p>
<h1><a class="header" href="#bio-1" id="bio-1">Bio</a></h1>
<p>Hello there! My name is <strong>Martin Ombura Jr.</strong> A software engineer based in Cape Town, South Africa currently working on 
<strong>Distributed Systems</strong> and <strong>Evolutionary Computation</strong> in <strong>Go</strong> and <strong>Rust</strong>. </p>
<p><strong>Email:</strong> me@martinomburajr.com</p>
<h1><a class="header" href="#vision-for-blog-and-videos" id="vision-for-blog-and-videos">Vision for Blog and Videos</a></h1>
<p>My goal with the content I aim to put out is to be <strong>interesting</strong>, <strong>problem-facing</strong> and <strong>complete</strong>. </p>
<h4><a class="header" href="#interesting" id="interesting">Interesting</a></h4>
<p>Interesting is something subjective. What I tend to find interesting  but through my various years working in Tech, I have narrowed down my current interests to the following:</p>
<ol>
<li>Deep Dives (e.g. Internal Workings of Systems)</li>
<li>Performance</li>
<li>Distributed Systems Concepts</li>
</ol>
<h4><a class="header" href="#problem-facing" id="problem-facing">Problem-Facing</a></h4>
<p>Solutions to problems are one thing, you can probably find them in StackOverflow or someother Q&amp;A platform. I am more interested in the problems I am interested in. With that being said,
I may not always find the optimal solution or any solution for that matter, but I want to be able to effectively contend with the problem, outline why the problem is challenging and give insight into some possible solutions. If the result is a good solution, then Hooray!, if not, hopefully you'll come away with deeper insight and appreciation to the problem, and maybe you can be inspired to solve it!</p>
<h4><a class="header" href="#complete" id="complete">Complete</a></h4>
<p>I've been writing articles for about 4 years now. I've noticed that there sometimes is a rush to get things out there quickly and succintly which I advocate for. However I am not afraid of having an article be 2000+ words or a video being 3+ hours if it takes that long to complete the task at hand. I will do my best to be concise where I can as much as I can.</p>
<p>I intend to output 
Articles or YouTube videos that go from idea conception to completion in their entirety in the best way I know how, including important things like</p>
<ul>
<li>Unit Tests,</li>
<li>GitHub READMEs</li>
<li>CI/CD or Deployments where necessary. </li>
</ul>
<h2><a class="header" href="#website-formatting" id="website-formatting">Website Formatting</a></h2>
<p>I am using <a href="https://github.com/rust-lang/mdBook"><strong>mdBook</strong></a> to generate the structure of this entire website. Check them out, star them or clone their repo to use it!</p>
<p><img src="blog/go/net-pkg/1-sockets-the-genesis-of-golang-connections-1/net_package_internals_banner.jpeg" alt="" /></p>
<p><strong>Author</strong>: Martin Ombura Jr.</p>
<p><strong>Date</strong>: May 19, 2019</p>
<h1><a class="header" href="#sockets-the-genesis-of-golang-connections--golang-net-pkg-1" id="sockets-the-genesis-of-golang-connections--golang-net-pkg-1">Sockets: The Genesis of Golang Connections — Golang net pkg #1</a></h1>
<p>Welcome to the first in a new series that attempts to breakdown the internals of
the Golang net package. The net package is filled with several networking
primitives that pair closely with the underlying OS to allow us to build world
class production networking applications. Renowned projects like Docker,
Kubernetes, CoreDNS, Traefik are architected in Go and are known for their
prowess in ability to quickly and efficiently shuffle packets to and from
various client server services.</p>
<p>In this article we shall perform a deep dive into the operating system (GOOS)
and look at Sockets and how they work, and start to piece together a model to
understand connections and networking. For the sake of demonstration, we shall
assume we are using a Unix based APIs.</p>
<h2><a class="header" href="#sockets" id="sockets">Sockets</a></h2>
<p>Sockets are a pretty old concept first widely introduced in 1983 in the 4.2BSD
implementation which then overflowed to pretty much every UNIX and other system.
Sockets are fundamentally a method of inter-process communication (IPC) that
extend to networked systems. Where other forms of IPC such as pipes and message
queues are limited to the machine itself, sockets can be opened and connections
from external sources can attach themselves to an available socket. To really
understand their role, we look at some of the typical methods used to call the
socket API, and observe a connection flow from one host to another.</p>
<h2><a class="header" href="#the-socket-api" id="the-socket-api">The Socket API</a></h2>
<p>There are about 5 core methods within the Socket API that applications that want
to network must call. These are <code>socket()</code>, <code>bind()</code>, <code>connect()</code>, <code>listen()</code> and
<code>accept()</code>. In this article we will look at <code>socket()</code> and <code>bind()</code></p>
<h3><a class="header" href="#1-socket" id="1-socket">1. Socket</a></h3>
<p>According to the <a href="https://man7.org/linux/man-pages/man2/socket.2.html">Linux man
pages</a>,</p>
<pre><code>The socket() call creates an endpoint for communication and returns a file descriptor that refers to that endpoint.
</code></pre>
<p>The creation of a socket is mostly performed by the kernel, so Go applications
must call this through the use of a syscall implemented in the syscall library.
Let’s examine the Go code where this syscall happens.</p>
<pre><code class="language-c">/**
* Code Snippet 1: Implementations of Socket syscall:
  Note the signatures shown for Unix and Windows are similar
  despite being on different GOOS.
*/

// Unix implementation of socket() system call
int socket(int domain, int type, int protocol);

// Windows implementation of socket() system call
SOCKET WSAAPI socket(int af, int type, int protocol);
</code></pre>
<p>Let’s take a look at each of the arguments.</p>
<p><code>domain:</code> The domain refers to the protocol family to be used in the
communication. this is sometimes referred to as the address family. Examples of
domains are:</p>
<p><img src="blog/go/net-pkg/1-sockets-the-genesis-of-golang-connections-1/socket_address_family.png" alt="Table 1: A list of Address Families supported by Windows. See more here" />
<strong>Table 1:</strong> A list of Address Families supported by Windows. See more here</p>
<p>Unix kernels also have <code>AF_UNIX</code> that performs communication within the kernel
on the same machine <em>(not used for external networking)</em>.</p>
<p><code>type:</code> The type represents the type of underlying transport to use. Represented
as either <code>SOCK_STREAM</code> for reliable, sequenced, connection oriented messages
(think TCP) as well as <code>SOCK_DGRAM</code> for connection-less, unreliable messages
(think UDP or UNIX connections).</p>
<p><code>protocol:</code> Protocol refers to a single protocol that supports the selected
socket. These are usually in a given protocol family and often this value is
defaulted to 0.</p>
<h3><a class="header" href="#2-bind" id="2-bind">2. Bind</a></h3>
<p>The next Important syscall is to the bind() method. After a socket is created
using the socket syscall() the socket exists without any address attached to it.
bind() locates the socket through the use of the file descriptor returned from
the socket creation, and attaches a network address to it.</p>
<pre><code class="language-c">/**
* Code Snippet 2: Implementations of bind() syscall: Note the similar function signatures.
*/

// Unix implementation of bind() system call
int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);

// Windows implementation of bind() system call
int WSAAPI bind(
  SOCKET         s,
  const sockaddr *name,
  int            namelen
);
</code></pre>
<p>Bind takes in the following arguments:</p>
<p><code>sockfd:</code> This represents the file descriptor of the socket returned after creation. Remember in the socket method, the return type is a file descriptor. In order to bind the socket we created, we use the file descriptor as the first argument to the bind method.</p>
<p><code>socketaddr:</code> Is a pointer to a struct that contains the address that the socket we created can be bound. The address must be “well-known” i.e fixed and resolved before binding. The address should not change after binding, otherwise a new socket will need to be created. DNS resolution should happen first, and we will look at this in an upcoming article.</p>
<p><code>socklen:</code> Refers to the size of the address struct</p>
<p>Bind is important as it provides a well-known path to and from the socket. It
also enables to kernel to broadcasts the whereabouts of the socket so external
systems can know where to connect. It is possible to omit a call to bind after
creating a socket, in which case the kernel will select a random available port
on localhost and bind to it. You may have noticed this when using
<code>httptest.NewServer()</code> method that does not give the option of specifying an
address, and lets the kernel handle it. Similarly when using a debugger in an
IDE e.g. Goland, when the debugger is run, the kernel chooses a port for the
debugger by either omitting a call to bind therefore returning a different port
each time. Once the debugger is stopped, the socket is destroyed.</p>
<h2><a class="header" href="#gos-implementation-of-socket-and-bind" id="gos-implementation-of-socket-and-bind">Go’s Implementation of Socket and Bind</a></h2>
<p>It’s time to shift our focus back to Go. We have seen the purpose of the
socket() and bind calls(), but the question remains, where and how are they
implemented.</p>
<pre><code class="language-c">/**
* Code Snippet 2: Implementations of bind() syscall: Note the similar function signatures.
*/


// This unimplemnted function is found in the syscall/syscall_linx_386.go file and is referenced by the socket function below.
// It is implemented in the syscall/asm_linux_s390x.s file
func rawsocketcall(call int, a0, a1, a2, a3, a4, a5 uintptr) (n int, err Errno)

// The bind method mirrors the Unix API for bind calls. A call to rawsocketcall is made (see methods above)
func bind(s int, addr unsafe.Pointer, addrlen _Socklen) (err error) {
	_, e := socketcall(_BIND, uintptr(s), uintptr(addr), uintptr(addrlen), 0, 0, 0)
	if e != 0 {
		err = e
	}
	return
}

// The socket method mirrors the Unix API for Socket calls. A call to rawsocketcall is made (see method above and below)
func socket(domain int, typ int, proto int) (fd int, err error) {
	fd, e := rawsocketcall(_SOCKET, uintptr(domain), uintptr(typ), uintptr(proto), 0, 0, 0)
	if e != 0 {
		err = e
	}
	return
}
</code></pre>
<pre><code class="language-assembly">// func rawsocketcall(call int, a0, a1, a2, a3, a4, a5 uintptr) (n int, err int)
// Kernel interface gets call sub-number and pointer to a0.
// This method is found in the syscall/asm_linux_s390x.s file
TEXT ·rawsocketcall(SB),NOSPLIT,$0-72
	MOVD	$SYS_SOCKETCALL, R1	// syscall entry
	MOVD	call+0(FP), R2		// socket call number
	MOVD	$a0+8(FP), R3		// pointer to call arguments
	MOVD	$0, R4
	MOVD	$0, R5
	MOVD	$0, R6
	MOVD	$0, R7
	SYSCALL
	MOVD	$0xfffffffffffff001, R8
	CMPUBLT	R2, R8, oksock1
	MOVD	$-1, n+56(FP)
	NEG	R2, R2
	MOVD	R2, err+64(FP)
	RET
oksock1:
	MOVD	R2, n+56(FP)
	MOVD	$0, err+64(FP)
	RET
</code></pre>
<p>The <code>golang-socket-syscall.go</code> file in <em>Code Snippet 3</em> above showcases the <code>socket()</code>
method with a signature similar to that of the UNIX <code>socket()</code> API. What is even
more interesting is that the call to the <code>rawsocketcall()</code> in the <code>socket()</code> refers
to a function stub that is actually implemented in Assembly. I wrote an article
detailing the importance of Assembly in Go. The Assembly code appears to perform
the underlying syscall and passing in relevant arguments received from the Go
application, to the kernel.</p>
<p>The implementation of <code>bind()</code> is very similar. It also conforms to the <code>bind()</code> in
the Unix interface. It also makes a call to rawsocketcall with a _BIND
parameter. This is just an integer constant that refers to the integer 2, where
<code>_SOCKET</code> refers to 1. Other syscalls have their own unique constant integer
identifier.</p>
<h2><a class="header" href="#a-quick-note-on-file-descriptors" id="a-quick-note-on-file-descriptors">A Quick Note on File Descriptors</a></h2>
<p>The <code>socket()</code> syscall we saw in <em>Code Snippet 1</em> returns an integer, this integer
will be extremely important and will lay the foundation for several of the
following articles. The term File Descriptor should be memorized and not
forgotten as it will popup quite a bit when we begin creating, reading and
writing to connections. One thing you can ponder on for now, is why its called a
“File” descriptor. I answer this in the a future article.</p>
<p>For now, I think this is a good place to stop as we now have an understanding of sockets and some of the core syscalls that must be performed to create and bind addresses to them. In the next article we look at how socket connections work between client-server services.</p>
<p><img src="blog/go/net-pkg/2-how-golang-connections-are-made-at-a-kernel-level/banner.jpeg" alt="Server and Icon from Freepik | Router Icon from srip" /></p>
<p><strong>Author</strong>: Martin Ombura Jr.</p>
<p><strong>Date</strong>: May 21, 2019</p>
<h1><a class="header" href="#how-golang-connections-are-made-at-a-kernel-level--golang-net-pkg-2" id="how-golang-connections-are-made-at-a-kernel-level--golang-net-pkg-2">How Golang Connections are Made at a Kernel Level — Golang net pkg #2</a></h1>
<p>In <a href="blog/go/net-pkg/2-how-golang-connections-are-made-at-a-kernel-level/../1-sockets-the-genesis-of-golang-connections-1/article.html">Part 1</a> of this series we introduced the idea of sockets, what they were,
common syscall APIs to creating and binding addresses to them. In this article
we introduce the other 3 core socket API methods and we visualize the connection
process between interconnected systems using the knowledge we gained.</p>
<h2><a class="header" href="#1-the-connect-listen-and-accept-socket-api-calls" id="1-the-connect-listen-and-accept-socket-api-calls">1. The Connect, Listen and Accept Socket API Calls</a></h2>
<p>In order to fully visualize how connections are set up, we need to introduce
three new socket API calls that will be of importance as we continue this
article series. These are <code>connect()</code>, <code>accept()</code> and <code>listen()</code></p>
<pre><code class="language-c">// Code Snippet 1: Connect() API Call
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;

int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
</code></pre>
<p>Connect is responsible for connecting a client with a server that is listening. The clients socket is referenced in the first argument sockfd and it connects to the servers bound address specified in the 2nd argument sockaddr. This is different from <code>bind()</code> as we saw in the previous article, that takes a socket and attaches a local address to it making it available from within the machine, whereas <code>connect()</code> has the ability to attach the address to a remote address that may want to use that socket to communicate. In most cases <code>bind()</code> would be used by a server to make its socket known, and <code>connect()</code> would be used by a <code>client()</code> to connect to the server. The 3rd argument is the addrlen that is simply used to specify the size of the addr <em>(2nd argument)</em>. If a <code>connect()</code> fails, it is good practice for the client to close the socket and attempt a new connection with a new socket.</p>
<h3><a class="header" href="#22-accept" id="22-accept">2.2 Accept</a></h3>
<pre><code class="language-c">// Code Snippet 2: Accept() API Call

#include &lt;sys/types.h&gt;          /* See NOTES */
#include &lt;sys/socket.h&gt;

int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen);
</code></pre>
<p>Accept is used to take an incoming connection on the listening socket indicated
by its socket file descriptor <code>sockfd</code> , it then creates a new socket and
returns the new file descriptor for new connections to read/write to. The
original socket that called <code>listen()</code> always remains open and can be used to
accept further connections. If there are no other connections, the call blocks
until new connections arrive.</p>
<h3><a class="header" href="#23-listen" id="23-listen">2.3 Listen</a></h3>
<pre><code class="language-c">// Code Snippet 3: Listen() API Call

#include &lt;sys/types.h&gt;          /* See NOTES */
#include &lt;sys/socket.h&gt;

int listen(int sockfd, int backlog);
</code></pre>
<p>Listen takes in the socket file descriptor <code>sockfd</code>, and marks that a socket as a
passive socket and is ready to accept incoming connections. Passive sockets
differ from active sockets in that when you create a socket with the <code>socket()</code>
command as shown in the previous article, these default to being active. This
active socket (client) can be used in a <code>connect()</code> call to create a connection to
a passive socket (server). The kernel can proceed to schedule other work as the
socket waits on a connection. The <code>backlog</code> argument defines a maximum queue
length of pending connections. If the number is exceeded the client can receive
a connection refused error.</p>
<p>Note: <code>listen()</code> cannot be re-applied to a connected socket that had a
successful <code>connect()</code> call from a client, or a socket returned by a call to
<code>accept()</code></p>
<h2><a class="header" href="#3-a-visualization-of-the-connection-process" id="3-a-visualization-of-the-connection-process">3. A Visualization of the Connection Process</a></h2>
<p>Now that we know the other pieces of the puzzle we can now visualize the
connection process between client and server. We shall use a connection-oriented
protocol like TCP <code>(SOCK_STREAM)</code> In <em>Figure 1</em> below we have two entities, a
client and server. Each entity contains a info-box with the calls its makes in
order to establish a usable connection-oriented transaction.</p>
<p><img src="blog/go/net-pkg/2-how-golang-connections-are-made-at-a-kernel-level/tcp.png" alt="" /></p>
<p><strong>Figure 1:</strong> Photo from <a href="https://en.wikipedia.org/wiki/Berkeley_sockets">Bekeley Sockets</a></p>
<ol>
<li>Server Socket Creation and Binding: A server starts of by calling <code>socket()</code> to create a socket. This socket acts as an endpoint for communication and returns a file descriptor for the socket.</li>
<li>Binding the Socket to an address: The server then calls <code>bind()</code> to bind a well-known address which must be supplied to the socket. If not, the socket can not accept connections from any remote host. If <code>bind()</code> is not called, the kernel may apply a random host port to to make the socket available from localhost only.</li>
<li>Server Calls Listen: The <code>listen()</code> is invoked by the server to allow it to begin accepting connections. It moves the socket from an active to passive state. At this point a client can initiate a connection.</li>
<li>Client Creates a Socket: A client must create a socket to allow a connection to perform read/write operationson that socket. A SOCK_STREAM socket type enables a bidirectional streaming. When, the client chooses to create the socket is not as important as when the client decides to call <code>connect()</code> to the servers address.</li>
<li>Server Calls Accept: Once the server calls <code>accept()</code>, the server blocks until there is a connection from a client. In a multi-threaded environment, the thread will block until the server is terminated prematurely or a connection from a client is created.</li>
<li>Client Calls Connect: The client is free to call <code>connect()</code> at this point, passing in the servers address. The server is available and ready to accept connections as it is in the passive state ready to <code>accept()</code> connections. When the server responds it will use the address of the client that’s stored in a network header (usually IP header). If the client calls <code>connect()</code> before the server calls <code>accept()</code> but after the server calls <code>listen()</code>, the connect would be added to the listeners backlog, if the backlog limit has been reached, the connection will be refused.</li>
<li>Client Write and Server Read: The client and server can begin to write to to the connection as if writing to a file. This abstraction of reading and writing to a connection as if it were a file is crucial to understanding low-level IO, and it will spring up quite often in subsequent articles. For now it is important to know the client sends a request by writing to the connection, the server reads the written data stream, and responds with another write to the connection. We shall look at the intricacies of reading and writing in a later article, but for now, keep in mind writing to a connection is inherently the same as writing to a file. The term file to the designers of unix tends to have a more abstract meaning than that of the way we use day to day.
Connection Termination: A connection can be terminated for several reasons,
either client or server terminating the connection, higher-level timeouts on
connections being sent, extraneous errors, connections on the <code>listen()</code> backlog
overflowing etc.</li>
</ol>
<p>This back and forth on a connection-oriented protocol may remind you of an image
you may have seen when learning TCP. That is because I have just described the
TCP connection flow to you using unix based syscalls, instead of SYN, ACKs etc
<em>(See Figure 2)</em>.</p>
<p align="center">
  <img align="center" src="blog/go/net-pkg/2-how-golang-connections-are-made-at-a-kernel-level/tcp_2.gif" alt="TCP Connection Flow taken from IBM">
</p>
<p>This is what happens under the hood when Go initiates connection-oriented client-server interactions. In the next article we begin to explore the idea of file descriptors a bit more and how connections have striking similarities to files.</p>
<h1><a class="header" href="#algorithms" id="algorithms">Algorithms</a></h1>
<p>Below are various categories of algorithms I have gone over.</p>
<ul>
<li><a href="datastructures-and-algorithms/algorithms/./dynamic/dynamic.html">Dynamic Programming</a></li>
<li><a href="datastructures-and-algorithms/algorithms/./greedy/greedy.html">Greedy Algorithms</a></li>
</ul>
<h1><a class="header" href="#dynamic-programming" id="dynamic-programming">Dynamic Programming</a></h1>
<h1><a class="header" href="#the-coin-change-change-making-problem" id="the-coin-change-change-making-problem">The Coin Change (Change-Making) Problem</a></h1>
<p>The coin change problem is an interesting pseudo-polynomial problem that involves finding all <strong>combinations</strong> of <code>coins</code> that when added together give a <code>total</code> value. The assumption is you have infinite number of denominations of those coins.</p>
<h4><a class="header" href="#example" id="example">Example</a></h4>
<p>Given a <code>total</code> of 5 and the following coin denominations <code>[1,2,3]</code> find all combinations of coins assuming you cannot run out of any denomination.</p>
<p>The answer would be the following:</p>
<pre><code>[1, 1, 1, 1, 1]
[2, 1, 1, 1]
[2, 2, 1]
[3, 2]
</code></pre>
<p>All the above add up to the given total of 20, and we can use as many denominations as we want.</p>
<h2><a class="header" href="#the-coin-change-algorithm" id="the-coin-change-algorithm">The Coin Change Algorithm</a></h2>
<p>Below is an implementation of the Coin Change Algorithm written in <code>Go</code>. The algorithm uses iteration instead of recursion as is typical with most Dynamic Programming problems, and solves it in <code>O(n^2)</code></p>
<pre><code class="language-go">   package main
   
   import &quot;fmt&quot;
   
   
   
   // Performs Coin Change Problem using iteration and not recursion.
   // It is possible to use dynamic programing for marginal gains. This problem is considered Pseudo-Polynomial meaning
   // its running time is a polynomial in the numeric value of the input (the largest integer present in the input) —
   // but not necessarily in the length of the input (the number of bits required to represent it),
   // which is the case for polynomial time algorithms.
   // https://en.wikipedia.org/wiki/Pseudo-polynomial_time
   //
   // O(n^2) + O(5n)
   func CoinChange(total int, coins []int) [][]int {
   	ans := make([][]int, 0)
   
   	// O(n)
   	// The cache is used to check if certain remainders e.g. (total-coin) exist as part of the initial coin set.
   	// Using a cache gives O(1) access for verification
   	coinsCache := make(map[int]bool)
   	for i := range coins {
   		coinsCache[coins[i]] = true
   	}
   
   	// O(n^2)
   	// Here we are subtracting the total from each set of coins until we hit the base condition of rem &gt; 0
   	for i := 0; i &lt; len(coins); i++ {
   		perm := make([]int, 0)
   		coin := coins[i]
   		rem := total-coin
   
   		// coin count is used to count how many times we have deducted the remainder with our given coin i.e coins[i]
   		coinCount := 1
   		for rem &gt; 0 {
   			// We verify if the remainder (rem) exists as part of our coin set
   			// If it does, then we add the remainder plus the number of same value coins used
   			if coinsCache[rem] {
   				perm = append(perm, rem)
   				for i := 0; i &lt; coinCount; i++ {
   					perm = append(perm, coin)
   				}
   				ans = append(ans, perm)
   				perm = make([]int, 0)
   			}
   			// We continue to decrement the remainder until we hit our base case
   			rem = rem - coin
   			coinCount++
   		}
   	}
   
   
   	// duplStruct is a temporary struct used to house the index of the duplicates found
   	type duplStruct struct {
   		index int
   		arr []int
   	}
   
   	// O(n)
   	// We know that in certain cases we may obtain duplicate entries e.g. [4, 5] or [5,
   	//4] this only occurs if the total is a sum of two valid coins. So if our total is 9, and our coins are [2,3,4,
   	//5] we know 4 and 5 will give us 9 but so will 5 and 4. Here we weed out our duplicates.
   	tempStore := make([]duplStruct, 0)
   	for i := range ans {
   		// We know for our special case that the length of the coins array will always be 2 if there are duplicates
   		//e.g. [4,5] or [5,4] is of length two. No other combination occurs if there are same-length duplicates
   		if len(ans[i]) == 2 {
   			dupl := duplStruct{
   				index: i,
   				arr:   ans[i],
   			}
   			tempStore = append(tempStore, dupl)
   		}
   	}
   
   	// O(n)
   	// Here we find the two duplicates and adjust our final array to exclude one of the pair of duplicates
   	if len(tempStore) == 2 {
   		if isDuplicate(tempStore[0].arr, tempStore[1].arr) {
   			index := tempStore[0].index
   			left := ans[:index]
   			right := ans[index+1:]
   
   			// Here we create a new array that excludes one of the two duplicates and we return the final ans
   			finAns := make([][]int, 0)
   			finAns = append(finAns, left...)
   			finAns = append(finAns, right...)
   			return finAns
   		}
   	}
   
   	return ans
   }
   
   
   
   // isDuplicate checks to see if two same-length slices are duplicates of one another by value and not by position.
   // [1,2] and [2,1] are considered duplicates, and so are [1,2] and [1,2]
   // O(2n)
   func isDuplicate(a, b []int) bool {
   	if len(a) != len(b) {
   		return false
   	}
   
   	cacheA := make(map[int]bool)
   	for i := range a {
   		cacheA[a[i]] = true
   	}
   
   	for i := range b {
   		if !cacheA[b[i]] {
   			return false
   		}
   	}
   	return true
   }
   
   func main() {
   	coins := []int{4,3,2,5}
   	total := 20
   
   	change := CoinChange(total, coins)
   	fmt.Printf(&quot;Coins: %v\n&quot; +
   		&quot;Total: %d\n\n&quot;, coins, total)
   	fmt.Printf(&quot;# of Change Combinations: %d\n&quot;, len(change))
   	fmt.Println(&quot;Change Combinations:&quot;)
   
   	for _, perms := range change {
   		fmt.Printf(&quot;%v\n&quot;, perms)
   	}
   }
</code></pre>
<p>Here is the output</p>
<pre><code class="language-shellscript">    Coins: [4 3 2 5]
    Total: 20
    
    Change Combinations: 6
    Change is:
    [4 4 4 4 4]
    [5 3 3 3 3 3]
    [2 3 3 3 3 3 3]
    [4 2 2 2 2 2 2 2 2]
    [2 2 2 2 2 2 2 2 2 2]
    [5 5 5 5]
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        
        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-133496300-1', 'auto');
                ga('send', 'pageview');
            }
        </script>
        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
